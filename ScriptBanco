CREATE TABLE IF NOT EXISTS CLIENTE(
CPF CHAR(14) PRIMARY KEY ,
NOME VARCHAR(30) NOT NULL,
SOBRENOME VARCHAR(40) NOT NULL,
EMAIL VARCHAR(60) NOT NULL,
DATANASC DATE NOT NULL,
CEP CHAR(9),
BAIRRO VARCHAR(50),
RUA VARCHAR(60),
NUMERO VARCHAR(6),
CIDADE CHAR(4),
TELEFONE VARCHAR(14),
CELULAR VARCHAR(14),
DATAREG DATE
);


CREATE TABLE IF NOT EXISTS COMPRA(
ID_COMPRA INTEGER PRIMARY KEY AUTOINCREMENT,
DATA DATE,
VALORTOTAL INTEGER,
VALORDESCONTO INTENGER,
CPF_CLIENTE CHAR(14),
FOREIGN KEY (CPF_CLIENTE) REFERENCES CLIENTE(CPF)
);


CREATE TABLE IF NOT EXISTS ITEM_COMPRA(
ID_ITEMCOMPRA INTEGER PRIMARY KEY AUTOINCREMENT,
PRECOUNITARIO INTEGER,
QUANTIDADE INT,
PRECOTOTAL INTEGER,
ID_PRODUTO INTEGER,
ID_COMPRA INTEGER,
FOREIGN KEY(id_produto) REFERENCES PRODUTO(IDPRODUTO),
FOREIGN KEY (ID_COMPRA) REFERENCES COMPRA (ID_COMPRA)
);

CREATE TABLE IF NOT EXISTS PRODUTO(
IDPRODUTO INTEGER  PRIMARY KEY AUTOINCREMENT,
NOME VARCHAR(45) NOT NULL,
MARCA VARCHAR(45) NOT NULL,
PRECO INTEGER NOT NULL,
DATAREG DATE NOT NULL
);


CREATE TABLE IF NOT EXISTS SERVICO(
ID_SERVICO INTEGER PRIMARY KEY AUTOINCREMENT,
NOME VARCHAR (30) NOT NULL,
PRECO INTEGER NOT NULL,
TEMPOGASTO DATIME 
);



CREATE TABLE IF NOT EXISTS CABELEIREIRO(
CPF CHAR(14) PRIMARY KEY,
EMAIL VARCHAR (60) NOT NULL,
NOME VARCHAR (45) NOT NULL ,
SEGUNDAE DATETIME,
TERCAE DATETIME,
QUARTAE DATETIME,
QUINTAE DATETIME,
SEXTAE DATETIME,
SABADOE DATETIME,
DOMINGOE DATETIME,
SEGUNDAS DATETIME,
TERCAS DATETIME,
QUARTAS DATETIME,
QUINTAS DATETIME,
SEXTAS DATETIME,
SABADOS DATETIME,
DOMINGOS DATETIME
);

CREATE TABLE IF NOT EXISTS PRODUTO_SERVICO(
ID_PRODUTO INT,
RENDIMENTO INT,
ID_SERVICO INT,
FOREIGN KEY(ID_PRODUTO) REFERENCES PRODUTO(ID_PRODUTO), 
FOREIGN KEY(ID_SERVICO) REFERENCES SERVICO(ID_SERVICO)
);

CREATE TABLE IF NOT EXISTS ESTOQUE(
ID_ESTOQUE INTEGER PRIMARY KEY AUTOINCREMENT,
ID_PRODUTO INTEGER NOT NULL,
QUANTIDADE INTEGER NOT NULL DEFAULT 0,
VALOR_UNITARIO INTEGER NOT NULL
);

CREATE TABLE IF NOT EXISTS AGENDAMENTO(
ID_AGENDAMENTO INTEGER PRIMARY KEY AUTOINCREMENT,
DATA DATE NOT NULL,
HORARIO DATETIME NOT NULL,
REALIZADO boolean,
TOTAL INTEGER,
DESCONTO INTEGER,
CPF_CLIENTE CHAR(14) NOT NULL
);

CREATE TABLE IF NOT EXISTS AGENDAMENTO_SERVICO(
ID_AGENDAMENTO INTEGER,
ID_SERVICO INTEGER,
FOREIGN KEY(ID_AGENDAMENTO) REFERENCES AGENDAMENTO(ID_AGENDAMENTO), 
FOREIGN KEY(ID_SERVICO) REFERENCES SERVICO(ID_SERVICO)
);



CREATE TABLE IF NOT EXISTS ORCAMENTO(
ID_ORCAMENTO INTEGER PRIMARY KEY AUTOINCREMENT,
NOME VARCHAR(30) NOT NULL,
JANEIRO INTEGER NOT NULL,
FEVEREIRO INTEGER NOT NULL,
MARCO INTEGER NOT NULL,
ABRIL INTEGER NOT NULL,
MAIO INTEGER NOT NULL,
JUNHO INTEGER NOT NULL,
JULHO INTEGER NOT NULL,
AGOSTO INTEGER NOT NULL,
SETEMBRO INTEGER NOT NULL,
OUTUBRO INTEGERNOT NULL,
NOVEMBRO INTEGER NOT NULL,
DEZEMBRO INTEGER NOT NULL,
PREVISTO BOOLEAN,
ANO VARCHAR(4),
CPF CHAR(14),
FOREIGN KEY (CPF) REFERENCES CABELEIREIRO(CPF)
);

CREATE TABLE IF NOT EXISTS ORCAMENTOSERVICO(
ID_ORCAMENTO INTEGER PRIMARY KEY AUTOINCREMENT,
NOMESERV VARCHAR(40) NOT NULL,
JANEIRO INTEGER NOT NULL,
FEVEREIRO INTEGER NOT NULL,
MARCO INTEGER NOT NULL,
ABRIL INTEGER NOT NULL,
MAIO INTEGER NOT NULL,
JUNHO INTEGER NOT NULL,
JULHO INTEGER NOT NULL,
AGOSTO INTEGER NOT NULL,
SETEMBRO INTEGER NOT NULL,
OUTUBRO INTEGERNOT NULL,
NOVEMBRO INTEGER NOT NULL,
DEZEMBRO INTEGER NOT NULL,
PREVISTO BOOLEAN,
ANO VARCHAR(4) NOT NULL,
ID_SERVICO INTEGER NOT NULL,
CPF CHAR(14),
FOREIGN KEY (CPF) REFERENCES CABELEIREIRO(CPF)
);



CREATE TABLE IF NOT EXISTS ORCAMENTOREALIZADO_DESPESAS(
ID_ORCAMENTOREALIZADO_DESPESAS INTEGER PRIMARY KEY AUTOINCREMENT,
NOME VARCHAR(40) NOT NULL,
JANEIRO INTEGER,
FEVEREIRO INTEGER,
MARCO INTEGER,
ABRIL INTEGER,
MAIO INTEGER,
JUNHO INTEGER,
JULHO INTEGER,
AGOSTO INTEGER,
SETEMBRO INTEGER,
OUTUBRO INTEGER,
NOVEMBRO INTEGER,
DEZEMBRO INTEGER,
ANO VARCHAR(4) NOT NULL,
DATAVENCIMENTO DATE,
DATAPAGAMENTO DATE,
STATUS BOOLEAN,
CPF CHAR(14),
FOREIGN KEY (CPF) REFERENCES CABELEIREIRO(CPF)
);

/* TESTES DO MATEUS */

SELECT QUINTAE, QUINTAS FROM CABELEIREIRO;
SELECT * FROM AGENDAMENTO;
SELECT * FROM ORCAMENTOSERVICO;
SELECT * FROM AGENDAMENTO_SERVICO;

/*SELECIONA COMPRA DO CABELEIREIRO*/
SELECT NOME,COMPRA.CPF_CLIENTE,VALORTOTAL, COMPRA.ID_COMPRA FROM CABELEIREIRO INNER JOIN COMPRA ON COMPRA.CPF_CLIENTE = CABELEIREIRO.CPF;

/*SELECIONA COMPRA DOS CLIENTE*/
SELECT NOME, VALORTOTAL,DATA FROM COMPRA INNER JOIN CLIENTE ON COMPRA.CPF_CLIENTE = CLIENTE.CPF ORDER BY NOME;

SELECT * FROM COMPRA;

/*SELECIONA PRODUTOS DA COMPRA DOS CLIENTE*/
            SELECT CLIENTE.NOME, ITEM_COMPRA.QUANTIDADE, PRODUTO.NOME, COMPRA.VALORTOTAL, COMPRA.ID_COMPRA FROM (( (COMPRA 
                INNER JOIN ITEM_COMPRA ON COMPRA.ID_COMPRA = ITEM_COMPRA.ID_COMPRA))
                INNER JOIN CLIENTE ON CLIENTE.CPF = COMPRA.CPF_CLIENTE)
                INNER JOIN PRODUTO ON ITEM_COMPRA.ID_PRODUTO =  PRODUTO.IDPRODUTO;
                
                
/*SELECIONA SERVIÇOS REALIZADO PELOS CLIENTES EM X AGENDAMENTO */
SELECT * FROM CLIENTE;
SELECT CLIENTE.NOME, SERVICO.NOME, AGENDAMENTO.ID_AGENDAMENTO FROM ((
             ((AGENDAMENTO_SERVICO 
             INNER JOIN SERVICO ON SERVICO.ID_SERVICO = AGENDAMENTO_SERVICO.ID_SERVICO )) 
             INNER JOIN AGENDAMENTO ON AGENDAMENTO.ID_AGENDAMENTO = AGENDAMENTO_SERVICO.ID_AGENDAMENTO)
             Inner JOIN CLIENTE ON CLIENTE.CPF ="500.494.768-66");
             

SELECT * FROM AGENDAMENTO WHERE DATA BETWEEN 1627257600000 AND 1627344000000;

SELECT * FROM AGENDAMENTO WHERE DATA BETWEEN (SELECT strftime('%s','2021-07-14', 'localtime')) AND (SELECT strftime('%s', 'now', 'localtime'));

INSERT INTO SERVICO (NOME, PRECO, TEMPOGASTO) VALUES (?, ?, ?);
INSERT INTO SERVICO_PRODUTO (ID_PRODUTO, ID_SERVICO) VALUES (? ,(SELECT ID_SERVICO FROM SERVICO ORDER BY ID_SERVICO DESC LIMIT 1));

SELECT ID_AGENDAMENTO, DATA, HORARIO, REALIZADO, CPF_CLIENTE, CLIENTE.NOME FROM AGENDAMENTO 
    INNER JOIN CLIENTE ON AGENDAMENTO.CPF_CLIENTE = CLIENTE.CPF AND CLIENTE.NOME LIKE '%arlete%';


SELECT * FROM SERVICO;

SELECT * FROM AGENDAMENTO;
SELECT * FROM AGENDAMENTO_SERVICO;
SELECT * FROM CABELEIREIRO;

/* RETORNA QTD DE UM SERVIÇO REALIZADO ENTRE DATAS ESPECÍFICAS */

SELECT SERVICO.NOME,SERVICO.ID_SERVICO,COUNT(AGENDAMENTO_SERVICO.ID_SERVICO) AS QUANTIDADE FROM AGENDAMENTO 
    INNER JOIN AGENDAMENTO_SERVICO
    ON AGENDAMENTO.ID_AGENDAMENTO = AGENDAMENTO_SERVICO.ID_AGENDAMENTO
    INNER JOIN SERVICO 
    ON SERVICO.ID_SERVICO = AGENDAMENTO_SERVICO.ID_SERVICO
WHERE AGENDAMENTO.DATA BETWEEN 1628564400000 AND 1628737200000 AND SERVICO.ID_SERVICO = 3;



/* TESTES DA MELISSA*/

/*RETORNAR PRODUTOS DE UMA COMPRA (ENTRE OUTROS) PELO CPF*/
SELECT * FROM ITEM_COMPRA
INNER JOIN PRODUTO ON PRODUTO.IDPRODUTO = ITEM_COMPRA.ID_PRODUTO
INNER JOIN COMPRA ON COMPRA.ID_COMPRA = ITEM_COMPRA.ID_COMPRA
WHERE CPF_CLIENTE = "500.494.768-66";